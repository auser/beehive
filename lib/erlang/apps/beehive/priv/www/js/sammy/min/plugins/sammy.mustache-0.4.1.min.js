// -- Sammy -- /plugins/sammy.mustache.js
// http://code.quirkey.com/sammy
// Version: 0.4.1
// Built: Mon Jan 11 22:02:12 -0500 2010
(function(b){if(!a){var a=function(){var c=function(){};c.prototype={otag:"{{",ctag:"}}",pragmas:{},render:function(g,f,e){if(g.indexOf(this.otag)==-1){return g}g=this.render_pragmas(g);var d=this.render_section(g,f,e);return this.render_tags(d,f,e)},render_pragmas:function(d){if(d.indexOf(this.otag+"%")==-1){return d}var f=this;var e=new RegExp(this.otag+"%(.+)"+this.ctag);return d.replace(e,function(h,g){f.pragmas[g]=true;return""})},render_partial:function(d,f,e){if(typeof(f[d])!="object"){throw ({message:"subcontext for '"+d+"' is not an object"})}if(!e||!e[d]){throw ({message:"unknown_partial"})}return this.render(e[d],f[d],e)},render_section:function(f,e,d){if(f.indexOf(this.otag+"#")==-1){return f}var h=this;var g=new RegExp(this.otag+"\\#(.+)"+this.ctag+"\\s*([\\s\\S]+?)"+this.otag+"\\/\\1"+this.ctag+"\\s*","mg");return f.replace(g,function(k,j,l){var m=h.find(j,e);if(h.is_array(m)){return h.map(m,function(n){return h.render(l,h.merge(e,h.create_context(n)),d)}).join("")}else{if(m){return h.render(l,e,d)}else{return""}}})},render_tags:function(j,h,g){var d=j.split("\n");var e=function(){return new RegExp(l.otag+"(=|!|>|\\{|%)?([^/#]+?)\\1?"+l.ctag+"+","g")};var l=this;var k=e();for(var f=0;f<d.length;f++){d[f]=d[f].replace(k,function(o,m,n){switch(m){case"!":return o;case"=":l.set_delimiters(n);k=e();f--;return"";case">":return l.render_partial(n,h,g);case"{":return l.find(n,h);return"";default:return l.escape(l.find(n,h))}},this)}return d.join("\n")},set_delimiters:function(e){var d=e.split(" ");this.otag=this.escape_regex(d[0]);this.ctag=this.escape_regex(d[1])},escape_regex:function(e){if(!arguments.callee.sRE){var d=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+d.join("|\\")+")","g")}return e.replace(arguments.callee.sRE,"\\$1")},find:function(d,e){d=this.trim(d);if(typeof e[d]==="function"){return e[d].apply(e)}if(e[d]!==undefined){return e[d]}return""},escape:function(d){return d.toString().replace(/[&"<>\\]/g,function(e){switch(e){case"&":return"&amp;";case"\\":return"\\\\";case'"':return'"';case"<":return"&lt;";case">":return"&gt;";default:return e}})},merge:function(e,d){var g={};for(var f in e){if(e.hasOwnProperty(f)){g[f]=e[f]}}for(var f in d){if(d.hasOwnProperty(f)){g[f]=d[f]}}return g},create_context:function(d){if(this.is_object(d)){return d}else{if(this.pragmas["JSTACHE-ENABLE-STRING-ARRAYS"]){return{".":d}}}},is_object:function(d){return d&&typeof d=="object"},is_array:function(d){return(d&&typeof d==="object"&&d.constructor===Array)},trim:function(d){return d.replace(/^\s*|\s*$/g,"")},map:function(g,e){if(typeof g.map=="function"){return g.map(e)}else{var f=[];var d=g.length;for(i=0;i<d;i++){f.push(e(g[i]))}return f}}};return({name:"mustache.js",version:"0.2",to_html:function(f,d,e){return new c().render(f,d,e)}})}()}Sammy=Sammy||{};Sammy.Mustache=function(e,c){var d=function(f,g){return a.to_html(f,b.extend({},this,g))};if(!c){c="mustache"}e.helper(c,d)}})(jQuery);